# å®¤å†…ç¯å…‰ç³»ç»Ÿä¼˜åŒ–æ€»ç»“

## ä¼˜åŒ–èƒŒæ™¯

ç”¨æˆ·åé¦ˆå®¤å†…ç¯å…‰æ•ˆæœä¸æ˜æ˜¾ï¼Œéœ€è¦å°†ç¯å…‰åˆ›å»ºå’Œä½ç½®è®¾ç½®åˆå¹¶åœ¨ä¸€èµ·ï¼Œç¡®ä¿åœ¨å»ºç­‘åŒ…å›´ç›’è®¡ç®—å®Œæˆåç«‹å³åˆ›å»ºå’Œè®¾ç½®ç¯å…‰ã€‚

## ä¼˜åŒ–æ–¹æ¡ˆ

### ğŸ”„ **æµç¨‹ä¼˜åŒ–**

**ä¼˜åŒ–å‰**:

```javascript
onEnter() {
  this.setIndoorHDRSky();
  this.createIndoorLights(); // åœ¨onEnteræ—¶åˆ›å»ºç¯å…‰
}

onLoaded() {
  this.adjustLightsToBuilding(this.building); // åœ¨onLoadedæ—¶è°ƒæ•´ä½ç½®
}
```

**ä¼˜åŒ–å**:

```javascript
onEnter() {
  this.setIndoorHDRSky();
  // ç§»é™¤ç¯å…‰åˆ›å»ºï¼Œç­‰å¾…å»ºç­‘åŠ è½½å®Œæˆ
}

onLoaded() {
  this.createAndSetupLights(this.building); // ä¸€æ¬¡æ€§åˆ›å»ºå’Œè®¾ç½®
}
```

### ğŸ¯ **æ ¸å¿ƒæ”¹è¿›**

1. **æ—¶æœºä¼˜åŒ–**: å°†ç¯å…‰åˆ›å»ºä» `onEnter` ç§»åˆ° `onLoaded`ï¼Œç¡®ä¿å»ºç­‘å®Œå…¨åŠ è½½åå†åˆ›å»ºç¯å…‰
2. **æ–¹æ³•åˆå¹¶**: åˆ›å»ºæ–°çš„ `createAndSetupLights()` æ–¹æ³•ï¼Œå°†åˆ›å»ºå’Œè®¾ç½®åˆå¹¶ä¸ºä¸€ä¸ªæ­¥éª¤
3. **åŒ…å›´ç›’ä¼˜å…ˆ**: å…ˆè®¡ç®—å»ºç­‘åŒ…å›´ç›’ï¼Œå†æ ¹æ®åŒ…å›´ç›’ä¿¡æ¯åˆ›å»ºå’Œè®¾ç½®ç¯å…‰

## å®ç°ç»†èŠ‚

### æ–°çš„ `createAndSetupLights` æ–¹æ³•

```javascript
createAndSetupLights(building) {
  // 1. è·å–å»ºç­‘åŒ…å›´ç›’
  const box = new THREE.Box3().setFromObject(building);
  const center = box.getCenter(new THREE.Vector3());
  const size = box.getSize(new THREE.Vector3());

  // 2. è®¡ç®—å»ºç­‘å°ºå¯¸
  const buildingWidth = size.x;
  const buildingHeight = size.y;
  const buildingDepth = size.z;
  const maxDimension = Math.max(buildingWidth, buildingHeight, buildingDepth);

  // 3. åˆ›å»ºç¯å…‰ç³»ç»Ÿ
  // ç¯å¢ƒå…‰
  const ambientLight = new THREE.AmbientLight(0xffffff, 1.5);

  // ä¸»æ–¹å‘å…‰
  const directionalLight = new THREE.DirectionalLight(0xffffff, 1.4);
  // é…ç½®é˜´å½±å‚æ•°...

  // è¾…åŠ©æ–¹å‘å…‰
  const auxiliaryLight = new THREE.DirectionalLight(0xffffff, 0.4);

  // 4. æ ¹æ®åŒ…å›´ç›’è®¾ç½®ä½ç½®
  const mainLightHeight = center.y + buildingHeight * 0.8;
  const mainLightOffset = maxDimension * 0.8;

  // ä¸»æ–¹å‘å…‰ä½ç½®
  this.lights.main.position.set(
    center.x - mainLightOffset * 0.5,
    mainLightHeight,
    center.z - mainLightOffset * 0.8
  );

  // 5. è®¾ç½®é˜´å½±å‚æ•°
  const shadowSize = maxDimension * 2;
  this.lights.main.shadow.camera.left = -shadowSize;
  // ... å…¶ä»–é˜´å½±å‚æ•°

  // 6. è°ƒæ•´ç¯å…‰å¼ºåº¦
  const buildingVolume = buildingWidth * buildingHeight * buildingDepth;
  const volumeFactor = Math.min(buildingVolume / 1000000, 2.0);
  this.lights.main.intensity = 1.4 * volumeFactor;
}
```

## ä¼˜åŒ–æ•ˆæœ

### âœ… **è§£å†³çš„é—®é¢˜**

1. **ç¯å…‰æ•ˆæœä¸æ˜æ˜¾**: ç°åœ¨ç¯å…‰ä½ç½®å®Œå…¨åŸºäºå»ºç­‘åŒ…å›´ç›’è®¡ç®—ï¼Œç¡®ä¿æœ€ä½³å…‰ç…§æ•ˆæœ
2. **æ—¶æœºé—®é¢˜**: ç¡®ä¿åœ¨å»ºç­‘å®Œå…¨åŠ è½½åå†åˆ›å»ºç¯å…‰ï¼Œé¿å…ä½ç½®è®¡ç®—é”™è¯¯
3. **ä»£ç åˆ†ç¦»**: å°†åˆ›å»ºå’Œè®¾ç½®åˆå¹¶ï¼Œå‡å°‘ä»£ç å¤æ‚åº¦

### ğŸ¨ **è§†è§‰æ•ˆæœæå‡**

- **æ›´å‡†ç¡®çš„ä½ç½®**: ç¯å…‰ä½ç½®å®Œå…¨åŸºäºå»ºç­‘å®é™…å°ºå¯¸
- **æ›´åˆé€‚çš„å¼ºåº¦**: æ ¹æ®å»ºç­‘ä½“ç§¯åŠ¨æ€è°ƒæ•´ç¯å…‰å¼ºåº¦
- **æ›´å¥½çš„é˜´å½±**: é˜´å½±èŒƒå›´æ ¹æ®å»ºç­‘å°ºå¯¸ä¼˜åŒ–

### âš¡ **æ€§èƒ½ä¼˜åŒ–**

- **å‡å°‘è°ƒç”¨æ¬¡æ•°**: ä»ä¸¤æ¬¡è°ƒç”¨ï¼ˆåˆ›å»º+è®¾ç½®ï¼‰å‡å°‘åˆ°ä¸€æ¬¡è°ƒç”¨
- **é¿å…é‡å¤è®¡ç®—**: åŒ…å›´ç›’è®¡ç®—ä¸€æ¬¡ï¼ŒåŒæ—¶ç”¨äºåˆ›å»ºå’Œè®¾ç½®
- **æ›´å¥½çš„èµ„æºç®¡ç†**: ç¡®ä¿ç¯å…‰åœ¨æ­£ç¡®çš„æ—¶æœºåˆ›å»º

## æµ‹è¯•éªŒè¯

### æµ‹è¯•é¡µé¢æ›´æ–°

æ›´æ–°äº† `test_indoor_lights_dynamic.html`ï¼Œæ·»åŠ äº†ï¼š

1. **æ–°çš„æ–¹æ³•**: `createAndSetupLights()` å‡½æ•°
2. **æ–°çš„æŒ‰é’®**: "åˆ›å»ºå¹¶è®¾ç½®ç¯å…‰" æŒ‰é’®
3. **ä¼˜åŒ–æµç¨‹**: "æ¨¡æ‹Ÿè¿›å…¥å®¤å†…" ç°åœ¨ä½¿ç”¨æ–°çš„åˆå¹¶æ–¹æ³•

### æµ‹è¯•åœºæ™¯

1. **åŸºç¡€åŠŸèƒ½æµ‹è¯•**

   - ç‚¹å‡»"æ¨¡æ‹Ÿè¿›å…¥å®¤å†…" â†’ è‡ªåŠ¨åˆ›å»ºå¹¶è®¾ç½®ç¯å…‰
   - ç‚¹å‡»"åˆ›å»ºå¹¶è®¾ç½®ç¯å…‰" â†’ æ‰‹åŠ¨æµ‹è¯•åˆå¹¶æ–¹æ³•

2. **å»ºç­‘å°ºå¯¸å˜åŒ–æµ‹è¯•**

   - ä¿®æ”¹å»ºç­‘å°ºå¯¸ â†’ é‡æ–°åˆ›å»ºå¹¶è®¾ç½®ç¯å…‰
   - éªŒè¯ç¯å…‰ä½ç½®å’Œå¼ºåº¦æ˜¯å¦æ­£ç¡®è°ƒæ•´

3. **æ€§èƒ½æµ‹è¯•**
   - å¤šæ¬¡è¿›å…¥/ç¦»å¼€ â†’ éªŒè¯èµ„æºç®¡ç†
   - å¤§å»ºç­‘æµ‹è¯• â†’ éªŒè¯æ€§èƒ½è¡¨ç°

## å…¼å®¹æ€§

- âœ… ä¿æŒä¸ç°æœ‰ç³»ç»Ÿçš„å®Œå…¨å…¼å®¹
- âœ… ä¿ç•™åŸæœ‰çš„ `createIndoorLights()` å’Œ `adjustLightsToBuilding()` æ–¹æ³•
- âœ… ä¸ HDR ç¯å¢ƒè´´å›¾ç³»ç»Ÿå®Œç¾é…åˆ
- âœ… ä¸åœºæ™¯åˆ‡æ¢ç³»ç»Ÿæ— ç¼é›†æˆ

## è°ƒè¯•åŠŸèƒ½

### æ§åˆ¶å°è¾“å‡º

æ–°çš„æ–¹æ³•æä¾›è¯¦ç»†çš„æ§åˆ¶å°è¾“å‡ºï¼š

```javascript
console.log("å»ºç­‘åŒ…å›´ç›’ä¿¡æ¯:", {
  center: center,
  size: size,
  min: min,
  max: max,
});

console.log("ç¯å…‰åˆ›å»ºå’Œä½ç½®è®¾ç½®å®Œæˆ:", {
  mainLight: this.lights.main.position,
  auxiliaryLight: this.lights.auxiliary.position,
  mainIntensity: this.lights.main.intensity,
  auxiliaryIntensity: this.lights.auxiliary.intensity,
  ambientIntensity: this.lights.ambient.intensity,
});
```

### è°ƒè¯•è¾…åŠ©å™¨

- å¯é€‰çš„ç¯å…‰è¾…åŠ©å™¨æ˜¾ç¤º
- é˜´å½±ç›¸æœºè¾…åŠ©å™¨
- å®æ—¶çŠ¶æ€ç›‘æ§

## æ€»ç»“

è¿™æ¬¡ä¼˜åŒ–è§£å†³äº†å®¤å†…ç¯å…‰æ•ˆæœä¸æ˜æ˜¾çš„é—®é¢˜ï¼Œé€šè¿‡ï¼š

1. **æ—¶æœºä¼˜åŒ–**: åœ¨å»ºç­‘å®Œå…¨åŠ è½½ååˆ›å»ºç¯å…‰
2. **æ–¹æ³•åˆå¹¶**: å°†åˆ›å»ºå’Œè®¾ç½®åˆå¹¶ä¸ºä¸€ä¸ªæ­¥éª¤
3. **åŒ…å›´ç›’ä¼˜å…ˆ**: ç¡®ä¿ç¯å…‰ä½ç½®å®Œå…¨åŸºäºå»ºç­‘å®é™…å°ºå¯¸

ä¼˜åŒ–åçš„ç³»ç»Ÿèƒ½å¤Ÿï¼š

- ä¸ºä¸åŒå°ºå¯¸çš„å»ºç­‘æä¾›æœ€ä½³çš„å…‰ç…§æ•ˆæœ
- ç¡®ä¿ç¯å…‰ä½ç½®å’Œå¼ºåº¦å®Œå…¨åŒ¹é…å»ºç­‘å°ºå¯¸
- æä¾›æ›´å¥½çš„è§†è§‰æ•ˆæœå’Œç”¨æˆ·ä½“éªŒ
- ä¿æŒä¼˜ç§€çš„æ€§èƒ½å’Œèµ„æºç®¡ç†

è¿™ä¸ªä¼˜åŒ–ç¡®ä¿äº†å®¤å†…åœºæ™¯çš„å…‰ç…§æ•ˆæœæ›´åŠ æ˜æ˜¾å’Œå‡†ç¡®ï¼Œä¸ºç”¨æˆ·æä¾›äº†æ›´å¥½çš„è§†è§‰ä½“éªŒã€‚
