<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>简单灯光测试</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: Arial, sans-serif;
      background: #1a1a1a;
      color: white;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .controls {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
    }

    button:hover {
      background: #45a049;
    }

    .log {
      background: #000;
      color: #0f0;
      padding: 15px;
      border-radius: 8px;
      height: 200px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 12px;
      margin-top: 20px;
    }

    #three-container {
      width: 100%;
      height: 600px;
      border: 2px solid #666;
      border-radius: 8px;
      margin-top: 20px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>简单灯光测试</h1>

    <div class="controls">
      <button onclick="addSimpleLights()">添加简单灯光</button>
      <button onclick="addComplexLights()">添加复杂灯光</button>
      <button onclick="clearLights()">清除灯光</button>
      <button onclick="addCube()">添加立方体</button>
      <button onclick="clearScene()">清除场景</button>
    </div>

    <div class="log">
      <div id="logContent">控制台日志将显示在这里...</div>
    </div>

    <div id="three-container"></div>
  </div>

  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';

    // 全局变量
    let scene, camera, renderer, controls;
    let lights = [];

    // 初始化Three.js场景
    function initScene () {
      // 创建场景
      scene = new THREE.Scene();

      // 创建相机
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(5, 5, 5);

      // 创建渲染器
      const container = document.getElementById('three-container');
      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(container.clientWidth, container.clientHeight);
      renderer.shadowMap.enabled = true;
      renderer.shadowMap.type = THREE.PCFSoftShadowMap;
      container.appendChild(renderer.domElement);

      // 创建控制器
      controls = new OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;

      // 添加网格辅助器
      const gridHelper = new THREE.GridHelper(10, 10);
      scene.add(gridHelper);

      // 添加坐标轴辅助器
      const axesHelper = new THREE.AxesHelper(5);
      scene.add(axesHelper);

      log("场景初始化完成");
    }

    // 添加简单灯光
    window.addSimpleLights = function () {
      log("添加简单灯光...");

      // 环境光
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
      scene.add(ambientLight);
      lights.push(ambientLight);

      // 方向光
      const directionalLight = new THREE.DirectionalLight(0xffffff, 1.0);
      directionalLight.position.set(5, 5, 5);
      scene.add(directionalLight);
      lights.push(directionalLight);

      log(`添加了 ${lights.length} 个灯光`);
      log("场景中的灯光数量:", scene.children.filter(child => child.isLight).length);
    };

    // 添加复杂灯光（模拟室内子系统）
    window.addComplexLights = function () {
      log("添加复杂灯光（模拟室内子系统）...");

      // 创建环境光
      const ambientLight = new THREE.AmbientLight(0xffffff, 1.5);
      scene.add(ambientLight);
      lights.push(ambientLight);

      // 创建主方向光
      const directionalLight = new THREE.DirectionalLight(0xffffff, 1.4);
      directionalLight.shadow.camera.near = 1;
      directionalLight.shadow.camera.far = 1000;
      directionalLight.shadow.camera.right = 1000;
      directionalLight.shadow.camera.left = -1000;
      directionalLight.shadow.camera.top = 600;
      directionalLight.shadow.camera.bottom = -600;
      directionalLight.shadow.mapSize.width = Math.pow(2, 11);
      directionalLight.shadow.mapSize.height = Math.pow(2, 11);
      directionalLight.shadow.blurSamples = 8;
      directionalLight.shadow.radius = 1.15;
      directionalLight.shadow.bias = -0.0015;
      directionalLight.castShadow = true;
      directionalLight.position.set(5, 10, 5);
      scene.add(directionalLight);
      lights.push(directionalLight);

      // 创建辅助方向光
      const auxiliaryLight = new THREE.DirectionalLight(0xffffff, 0.4);
      auxiliaryLight.position.set(-5, 8, -5);
      scene.add(auxiliaryLight);
      lights.push(auxiliaryLight);

      log(`添加了 ${lights.length} 个复杂灯光`);
      log("场景中的灯光数量:", scene.children.filter(child => child.isLight).length);

      // 添加灯光辅助器
      const mainLightHelper = new THREE.DirectionalLightHelper(directionalLight, 2);
      scene.add(mainLightHelper);
      lights.push(mainLightHelper);

      const auxiliaryLightHelper = new THREE.DirectionalLightHelper(auxiliaryLight, 1);
      scene.add(auxiliaryLightHelper);
      lights.push(auxiliaryLightHelper);
    };

    // 清除灯光
    window.clearLights = function () {
      log("清除灯光...");

      lights.forEach(light => {
        scene.remove(light);
        if (light.dispose) {
          light.dispose();
        }
      });

      lights = [];
      log("灯光已清除");
      log("场景中的灯光数量:", scene.children.filter(child => child.isLight).length);
    };

    // 添加立方体
    window.addCube = function () {
      log("添加立方体...");

      const geometry = new THREE.BoxGeometry(1, 1, 1);
      const material = new THREE.MeshStandardMaterial({
        color: 0x00ff00,
        metalness: 0.2,
        roughness: 0.8
      });
      const cube = new THREE.Mesh(geometry, material);
      cube.castShadow = true;
      cube.receiveShadow = true;
      cube.position.set(0, 0.5, 0);
      scene.add(cube);

      log("立方体已添加");
    };

    // 清除场景
    window.clearScene = function () {
      log("清除场景...");

      // 清除所有对象（除了网格和坐标轴）
      const childrenToRemove = scene.children.filter(child =>
        !(child instanceof THREE.GridHelper || child instanceof THREE.AxesHelper)
      );

      childrenToRemove.forEach(child => {
        scene.remove(child);
        if (child.geometry) child.geometry.dispose();
        if (child.material) child.material.dispose();
        if (child.dispose) child.dispose();
      });

      lights = [];
      log("场景已清除");
    };

    // 日志函数
    function log (...args) {
      const logContent = document.getElementById('logContent');
      const timestamp = new Date().toLocaleTimeString();
      const message = `[${timestamp}] ${args.join(' ')}`;
      logContent.innerHTML += message + '<br>';
      logContent.scrollTop = logContent.scrollHeight;
      console.log(...args);
    }

    // 动画循环
    function animate () {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }

    // 窗口大小调整
    window.addEventListener('resize', () => {
      const container = document.getElementById('three-container');
      camera.aspect = container.clientWidth / container.clientHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(container.clientWidth, container.clientHeight);
    });

    // 初始化
    initScene();
    animate();
    log("简单灯光测试页面已加载");
  </script>
</body>

</html>