const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./weather-e4gHIfPD.js","./main-jFEi-GMT.js","./main-CFrdjDHn.css","./dataProgress-DOqxgvRA.js"])))=>i.map(i=>d[i]);
import{_ as __vitePreload}from"./main-jFEi-GMT.js";import"./weather-e4gHIfPD.js";const TransformMap={sunny:"SUNNY",rain:"RAIN",snow:"SNOW",day:"DAY",night:"NIGHT",science:"SCIENCE"},onMessage=async()=>{const[{SUNNY,RAIN,SNOW,DAY,NIGHT,SCIENCE},{doFenceData,equipData,inspectionData,personDangerData,gatherDangerDate,sceneChange,searchData,realTimeData,dangerHistoryData}]=await Promise.all([__vitePreload(()=>import("./weather-e4gHIfPD.js").then(a=>a.bH),__vite__mapDeps([0,1,2]),import.meta.url),__vitePreload(()=>import("./dataProgress-DOqxgvRA.js"),__vite__mapDeps([3,0,1,2]),import.meta.url)]);Object.keys(TransformMap).forEach(key=>{TransformMap[key]=eval(TransformMap[key])});const waitForStore3D=()=>new Promise(a=>{const c=()=>{window.Core?a(window.Core):setTimeout(c,100)};c()}),core=await waitForStore3D();let changeSceneTimeout=null,lastChangeSceneParam=null,lastChangeSceneTime=0,isChangingScene=!1;window.addEventListener("message",a=>{if(!core){console.warn("Store3D 实例尚未初始化");return}if(a.data&&a.data.cmd)switch(a.data.cmd){case"changeLighting":{const e=TransformMap[a.data.param];if(!e){console.warn("无效的光照参数:",a.data.param);return}core.changeLighting(e);break}case"changeWeather":{const e=a.data.param;if(!e||!e.type){console.warn("无效的天气参数:",e);return}core.ground.switchWeather({type:e.type,level:e.level});break}case"close":{core._stopRender();break}case"open":{core._beginRender();break}case"setCameraState":{core.setCameraState(a.data.param);break}case"changeSystem":{core.changeSystem(a.data.param);break}case"changeScene":{const e=a.data.param,r=Date.now();if(isChangingScene){console.log("正在切换场景，忽略重复请求:",e);return}if(changeSceneTimeout&&clearTimeout(changeSceneTimeout),lastChangeSceneParam===e&&r-(lastChangeSceneTime||0)<1e3){console.log("忽略重复的场景切换请求:",e);return}lastChangeSceneParam=e,lastChangeSceneTime=r,isChangingScene=!0,changeSceneTimeout=setTimeout(()=>{if(console.log("执行场景切换:",e),e==="地面")core.changeSystem("ground");else{const o={制冷:"AFS9512042_制冷",制热:"AFS9512043_制热",配电:"AFS9512044_配电室"};core.changeSystem("indoorSubsystem",o[e])}setTimeout(()=>{isChangingScene=!1},500)},200);break}case"setWanderState":{a.data.param?core.beginWander():core.endWander();break}case"startMeasuring":{core.startMeasuring();break}case"removeMeasuring":{core.removeMeasuring();break}case"startMeasureArea":{core.startMeasureArea();break}case"removeMeasureArea":{core.removeMeasureArea();break}case"setHeatmap":{core.setHeatmap(a.data.param);break}case"init":{core.orientation.init(a.data.param);let e=core.orientation.followId;e&&core.followCheck(a,e);break}case"getInspectin":{let e=inspectionData(a.data.param);core.search(e);break}case"removeInset":{core.clearEquipType(a.data.param);break}case"getCameraList":{const{data:e}=a.data.param;let r=equipData(e);core.processingEquipment(r,"camera");break}case"inspectionSystem_initialData":let c=equipData(a.data.param);core.processingEquipment(c,"inspectionSystem");break;case"hideInspectionSystemIcon":core.hideInspectionSystemIcon(a.data.param);case"getBeaconList":{const{data:e}=a.data.param;let r=equipData(e);core.processingEquipment(r,"beacon");break}case"trackInit":case"trackStart":case"trackStop":case"trackSpeedUp":case"trackSpeedDown":case"trackProgress":case"trackAngleSwitch":case"trackClear":{core.historyTrackCommand(a.data);break}case"buildingNumber":{let e=a.data.param;core.changeBuildingNum(e);break}case"buildingList":{a.data.param;break}case"cherryPick":{core.cherryPick(a.data.param);break}case"startSelect":{core.changeBoxSelect(a.data.param);break}case"reSelect":{core.reSelect();break}case"fenceList":{a.data.param.data.map(e=>{const{id:r,name:o,type:s}=e;let t={fenceData:doFenceData(e),id:r,name:o,type:"area"};core.createFence(t)});break}case"resetCamera":{console.log("执行重置视角功能"),core.resetCamera();break}case"autoRoute":{const e=a.data.param;console.log(`收到自转控制命令: ${e?"开启":"关闭"}`),core.setAutoRotate(e);break}case"startSearch":{let e=searchData(a.data.param);core.search(e);break}case"closeDialog":{core.isIndoorModel()&&(core.hideBuildingDialog(),core.setIndoorModel(!1));let e=a.data.param;core.ground.boxSelectStatus||core.bindGroundEvent(),core.clearSelected(e);break}case"personFollow":const{id:l,sceneType:n,originId:i}=a.data.param;let m=sceneChange({sceneType:n,originId:i});core.startFollow({id:l,originId:i,sceneType:n,sceneChangeType:m});break;case"removePersonFollow":{core.bindSearchEvent(),core.cancelFollow();break}case"changeBuildingFloor":{core.changeFloor(a.data.param);break}case"changeIndoor":{core.changeIndoor(a.data.param);break}case"goBack":{core.changeSystem("ground");break}case"removeAllPerson":{core.clearAllPerson();break}case"personDanger":{let e=personDangerData(a.data.param);core.search(e);break}case"areaDanger":{const{fenceData:e,id:r,name:o,type:s,originId:d,sceneType:t}=a.data.param;let g={fenceData:doFenceData(a.data.param),id:r,name:o,type:"danger"};core.dangerFenceInit(g);break}case"clearDanger":{core.clearDanger();break}case"closeBuildingDialog":{let e=a.data.param;core.bindGroundEvent(),core.hideBuildingDialog(e);break}case"closeCameraDialog":{core.isIndoorModel()&&(core.hideBuildingDialog(),core.setIndoorModel(!1));let e=a.data.param;core.bindGroundEvent(),core.hideCameraDialog(e);break}case"hideCameraIcon":{core.hideCameraById(a.data.param);break}case"mouseEventSwitch":core.changeMouseEventSwitch(a.data.param);break;case"switchGather":{core.switchGatherStatus(a.data.param);break}case"setGatherLevel":{core.setGatherLevel(a.data.param);break}case"roamEnabled":{core.roamEnabled(a.data.param);break}case"roamDuration":{core.roamDuration(a.data.param);break}case"gatherDanger":{let e=gatherDangerDate(a.data.param);core.gatherWarning.gatherDanger(e);break}case"gatherNow":{let e=realTimeData(a.data.param);core.gatherWarning.realTimeGather(e);break}case"clearGatherDanger":{core.gatherWarning.disposeGather();break}case"factoryChange":{let e=core.currentSystem.clearBuildingFence?core.currentSystem.clearBuildingFence.bind(core.currentSystem):null;e&&e();const r=doFenceData(a.data.param[0]),{id:o,name:s,type:d}=a.data.param[0];let t={fenceData:r,id:o,name:s,type:"building"};core.createFence(t);break}case"gatherOrSilentArea":{a.data.param.forEach(e=>{e.areaDataOut.push(e.areaDataOut[0]),core.ground.gatherOrSilentPlate.create(e),e.areaType===3&&core.indoorSubsystem.setFloorGatherOrSilent(e)});break}case"clearGatherOrSilentArea":{core.ground.gatherOrSilentPlate.dispose(),core.indoorSubsystem.disposeGatherOrSilent();break}case"escapeRoute":{core.ground.escapeRoute.init(a.data.param);break}case"clearEscapeRoute":{core.ground.escapeRoute.dispose();break}case"meetingPoint":{a.data.param.forEach((e,r)=>{core.ground.meetingPoint.create({id:r,name:String(r),position:e})});break}case"webUpdateModel":{core.indoorSubsystem&&core.indoorSubsystem.updateDeviceLabels(a.data.param);break}case"clearDeviceLabels":{if(core.indoorSubsystem){const e=a.data.param&&a.data.param.deviceCodes;core.indoorSubsystem.clearDeviceLabelsAndInstance(e)}break}case"checkStorageStatus":{core.indoorSubsystem&&(console.log("=== 存储状态检查 ==="),console.log("当前楼层:",core.indoorSubsystem.currentFloor?core.indoorSubsystem.currentFloor.name:"null"),console.log("存储的数据:",core.indoorSubsystem.deviceLabelsData),console.log("设备标签数量:",core.indoorSubsystem.deviceLabels?core.indoorSubsystem.deviceLabels.length:0),console.log("=================="));break}}})};export{onMessage};
